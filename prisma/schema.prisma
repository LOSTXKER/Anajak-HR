generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model announcement_reads {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  announcement_id String        @db.Uuid
  employee_id     String        @db.Uuid
  read_at         DateTime?     @default(now()) @db.Timestamptz(6)
  announcements   announcements @relation(fields: [announcement_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  employees       employees     @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([announcement_id, employee_id])
  @@index([announcement_id], map: "idx_announcement_reads_announcement")
  @@index([employee_id, read_at(sort: Desc)], map: "idx_announcement_reads_employee")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model announcements {
  id                   String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title                String               @db.VarChar(200)
  message              String
  priority             String?              @default("normal") @db.VarChar(20)
  category             String?              @default("general") @db.VarChar(50)
  target_type          String?              @default("all") @db.VarChar(20)
  target_branch_id     String?              @db.Uuid
  target_employee_ids  String[]
  published            Boolean?             @default(false)
  published_at         DateTime?            @db.Timestamptz(6)
  expires_at           DateTime?            @db.Timestamptz(6)
  send_notification    Boolean?             @default(true)
  notification_sent_at DateTime?            @db.Timestamptz(6)
  created_by           String               @db.Uuid
  created_at           DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?            @default(now()) @db.Timestamptz(6)
  deleted_at           DateTime?            @db.Timestamptz(6)
  announcement_reads   announcement_reads[]
  employees            employees            @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  branches             branches?            @relation(fields: [target_branch_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model attendance_anomalies {
  id                                                    String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  attendance_id                                         String?          @db.Uuid
  employee_id                                           String?          @db.Uuid
  date                                                  DateTime         @db.Date
  anomaly_type                                          String
  description                                           String?
  status                                                String?          @default("pending")
  resolution_note                                       String?
  resolved_by                                           String?          @db.Uuid
  resolved_at                                           DateTime?        @db.Timestamptz(6)
  created_at                                            DateTime?        @default(now()) @db.Timestamptz(6)
  attendance_logs                                       attendance_logs? @relation(fields: [attendance_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  employees_attendance_anomalies_employee_idToemployees employees?       @relation("attendance_anomalies_employee_idToemployees", fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  employees_attendance_anomalies_resolved_byToemployees employees?       @relation("attendance_anomalies_resolved_byToemployees", fields: [resolved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model attendance_logs {
  id                                               String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employee_id                                      String                 @db.Uuid
  work_date                                        DateTime               @db.Date
  clock_in_time                                    DateTime?              @db.Timestamptz(6)
  clock_in_gps_lat                                 Decimal?               @db.Decimal(10, 8)
  clock_in_gps_lng                                 Decimal?               @db.Decimal(11, 8)
  clock_in_photo_url                               String?
  clock_out_time                                   DateTime?              @db.Timestamptz(6)
  clock_out_gps_lat                                Decimal?               @db.Decimal(10, 8)
  clock_out_gps_lng                                Decimal?               @db.Decimal(11, 8)
  clock_out_photo_url                              String?
  total_hours                                      Decimal?               @db.Decimal(5, 2)
  is_late                                          Boolean?               @default(false)
  status                                           String?                @default("present") @db.VarChar(20)
  work_mode                                        String?                @db.VarChar(20)
  note                                             String?
  created_at                                       DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at                                       DateTime?              @default(now()) @db.Timestamptz(6)
  late_minutes                                     Int?                   @default(0)
  edit_reason                                      String?
  edited_by                                        String?                @db.Uuid
  edited_at                                        DateTime?              @db.Timestamptz(6)
  original_clock_in                                DateTime?              @db.Timestamptz(6)
  original_clock_out                               DateTime?              @db.Timestamptz(6)
  auto_checkout                                    Boolean?               @default(false)
  auto_checkout_reason                             String?
  reminder_count                                   Int?                   @default(0)
  attendance_anomalies                             attendance_anomalies[]
  employees_attendance_logs_edited_byToemployees   employees?             @relation("attendance_logs_edited_byToemployees", fields: [edited_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees_attendance_logs_employee_idToemployees employees              @relation("attendance_logs_employee_idToemployees", fields: [employee_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([employee_id, work_date], map: "attendance_logs_employee_date_unique")
  @@index([employee_id, work_date], map: "idx_attendance_employee_date")
  @@index([work_date], map: "idx_attendance_work_date")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model branches {
  id            String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name          String          @db.VarChar(255)
  address       String
  gps_lat       Decimal         @db.Decimal(10, 8)
  gps_lng       Decimal         @db.Decimal(11, 8)
  radius_meters Int?            @default(100)
  created_at    DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at    DateTime?       @default(now()) @db.Timestamptz(6)
  announcements announcements[]
  employees     employees[]
  holidays      holidays[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model employees {
  id                                                               String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                                                             String                 @db.VarChar(255)
  email                                                            String                 @unique @db.VarChar(255)
  phone                                                            String                 @db.VarChar(20)
  role                                                             String?                @default("staff") @db.VarChar(20)
  base_salary_rate                                                 Decimal?               @db.Decimal(10, 2)
  ot_rate_1x                                                       Decimal?               @default(1.0) @db.Decimal(5, 2)
  ot_rate_1_5x                                                     Decimal?               @default(1.5) @db.Decimal(5, 2)
  ot_rate_2x                                                       Decimal?               @default(2.0) @db.Decimal(5, 2)
  face_profile_image_url                                           String?
  device_id                                                        String?                @db.VarChar(255)
  branch_id                                                        String?                @db.Uuid
  created_at                                                       DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at                                                       DateTime?              @default(now()) @db.Timestamptz(6)
  employee_code                                                    String?                @db.VarChar(50)
  account_status                                                   String?                @default("approved") @db.VarChar(20)
  approved_by                                                      String?                @db.Uuid
  approved_at                                                      DateTime?              @db.Timestamptz(6)
  rejection_reason                                                 String?
  line_user_id                                                     String?                @db.VarChar(255)
  base_salary                                                      Decimal?               @default(0) @db.Decimal(12, 2)
  commission                                                       Decimal?               @default(0) @db.Decimal(12, 2)
  exclude_from_payroll                                             Boolean?               @default(false)
  is_system_account                                                Boolean?               @default(false)
  annual_leave_quota                                               Int?                   @default(10)
  sick_leave_quota                                                 Int?                   @default(30)
  personal_leave_quota                                             Int?                   @default(3)
  deleted_at                                                       DateTime?              @db.Timestamptz(6)
  deleted_by                                                       String?                @db.Uuid
  announcement_reads                                               announcement_reads[]
  announcements                                                    announcements[]
  attendance_anomalies_attendance_anomalies_employee_idToemployees attendance_anomalies[] @relation("attendance_anomalies_employee_idToemployees")
  attendance_anomalies_attendance_anomalies_resolved_byToemployees attendance_anomalies[] @relation("attendance_anomalies_resolved_byToemployees")
  attendance_logs_attendance_logs_edited_byToemployees             attendance_logs[]      @relation("attendance_logs_edited_byToemployees")
  attendance_logs_attendance_logs_employee_idToemployees           attendance_logs[]      @relation("attendance_logs_employee_idToemployees")
  employees                                                        employees?             @relation("employeesToemployees", fields: [approved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  deleted_by_employee                                              employees?             @relation("employees_deleted_by", fields: [deleted_by], references: [id], onDelete: SetNull, onUpdate: NoAction)
  other_employees                                                  employees[]            @relation("employeesToemployees")
  deleted_employees                                                employees[]            @relation("employees_deleted_by")
  branches                                                         branches?              @relation(fields: [branch_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  field_work_requests_field_work_requests_approved_byToemployees   field_work_requests[]  @relation("field_work_requests_approved_byToemployees")
  field_work_requests_field_work_requests_cancelled_byToemployees  field_work_requests[]  @relation("field_work_requests_cancelled_byToemployees")
  field_work_requests_field_work_requests_employee_idToemployees   field_work_requests[]  @relation("field_work_requests_employee_idToemployees")
  late_requests_late_requests_approved_byToemployees               late_requests[]        @relation("late_requests_approved_byToemployees")
  late_requests_late_requests_cancelled_byToemployees              late_requests[]        @relation("late_requests_cancelled_byToemployees")
  late_requests_late_requests_employee_idToemployees               late_requests[]        @relation("late_requests_employee_idToemployees")
  leave_balances                                                   leave_balances[]
  leave_requests_leave_requests_approved_byToemployees             leave_requests[]       @relation("leave_requests_approved_byToemployees")
  leave_requests_leave_requests_cancelled_byToemployees            leave_requests[]       @relation("leave_requests_cancelled_byToemployees")
  leave_requests_leave_requests_employee_idToemployees             leave_requests[]       @relation("leave_requests_employee_idToemployees")
  ot_requests_ot_requests_approved_byToemployees                   ot_requests[]          @relation("ot_requests_approved_byToemployees")
  ot_requests_ot_requests_cancelled_byToemployees                  ot_requests[]          @relation("ot_requests_cancelled_byToemployees")
  ot_requests_ot_requests_employee_idToemployees                   ot_requests[]          @relation("ot_requests_employee_idToemployees")
  push_subscriptions                                               push_subscriptions?
  wfh_requests_wfh_requests_approved_byToemployees                 wfh_requests[]         @relation("wfh_requests_approved_byToemployees")
  wfh_requests_wfh_requests_cancelled_byToemployees                wfh_requests[]         @relation("wfh_requests_cancelled_byToemployees")
  wfh_requests_wfh_requests_employee_idToemployees                 wfh_requests[]         @relation("wfh_requests_employee_idToemployees")
  salary_history                                                   salary_history[]
  employee_badges                                                  employee_badges[]
  point_transactions                                               point_transactions[]
  employee_points                                                  employee_points?
  kpi_periods_created                                              kpi_periods[]              @relation("kpi_periods_created_byToemployees")
  kpi_goals_kpi_goals_employee_idToemployees                       kpi_goals[]                @relation("kpi_goals_employee_idToemployees")
  kpi_goals_kpi_goals_approved_byToemployees                       kpi_goals[]                @relation("kpi_goals_approved_byToemployees")
  kpi_goal_progress_created                                        kpi_goal_progress[]        @relation("kpi_goal_progress_created_byToemployees")
  kpi_evaluations_kpi_evaluations_employee_idToemployees           kpi_evaluations[]          @relation("kpi_evaluations_employee_idToemployees")
  kpi_evaluations_kpi_evaluations_evaluator_idToemployees          kpi_evaluations[]          @relation("kpi_evaluations_evaluator_idToemployees")
  kpi_auto_metrics                                                 kpi_auto_metrics[]

  @@index([account_status], map: "idx_employees_account_status")
  @@index([branch_id], map: "idx_employees_branch")
  @@index([line_user_id], map: "idx_employees_line_user_id")
  @@index([role], map: "idx_employees_role")
  @@index([deleted_at], map: "idx_employees_deleted_at")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model field_work_requests {
  id                                                    String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employee_id                                           String     @db.Uuid
  date                                                  DateTime   @db.Date
  is_half_day                                           Boolean?   @default(false)
  location                                              String
  reason                                                String
  status                                                String?    @default("pending") @db.VarChar(20)
  approved_by                                           String?    @db.Uuid
  approved_at                                           DateTime?  @db.Timestamptz(6)
  created_at                                            DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at                                            DateTime?  @default(now()) @db.Timestamptz(6)
  cancelled_by                                          String?    @db.Uuid
  cancelled_at                                          DateTime?  @db.Timestamptz(6)
  cancel_reason                                         String?
  employees_field_work_requests_approved_byToemployees  employees? @relation("field_work_requests_approved_byToemployees", fields: [approved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees_field_work_requests_cancelled_byToemployees employees? @relation("field_work_requests_cancelled_byToemployees", fields: [cancelled_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees_field_work_requests_employee_idToemployees  employees  @relation("field_work_requests_employee_idToemployees", fields: [employee_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([date], map: "idx_field_work_date")
  @@index([employee_id], map: "idx_field_work_employee")
  @@index([cancelled_by], map: "idx_field_work_requests_cancelled_by")
  @@index([status], map: "idx_field_work_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model holidays {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  date       DateTime  @db.Date
  name       String    @db.VarChar(255)
  type       String?   @default("public") @db.VarChar(20)
  branch_id  String?   @db.Uuid
  is_active  Boolean?  @default(true)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  branches   branches? @relation(fields: [branch_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model late_requests {
  id                                              String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employee_id                                     String     @db.Uuid
  request_date                                    DateTime   @db.Date
  reason                                          String
  expected_arrival_time                           DateTime?  @db.Time(6)
  actual_late_minutes                             Int?
  status                                          String?    @default("pending") @db.VarChar(20)
  approved_by                                     String?    @db.Uuid
  approved_at                                     DateTime?  @db.Timestamptz(6)
  admin_note                                      String?
  created_at                                      DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at                                      DateTime?  @default(now()) @db.Timestamptz(6)
  cancelled_by                                    String?    @db.Uuid
  cancelled_at                                    DateTime?  @db.Timestamptz(6)
  cancel_reason                                   String?
  employees_late_requests_approved_byToemployees  employees? @relation("late_requests_approved_byToemployees", fields: [approved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees_late_requests_cancelled_byToemployees employees? @relation("late_requests_cancelled_byToemployees", fields: [cancelled_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees_late_requests_employee_idToemployees  employees  @relation("late_requests_employee_idToemployees", fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([cancelled_by], map: "idx_late_requests_cancelled_by")
  @@index([request_date], map: "idx_late_requests_date")
  @@index([employee_id], map: "idx_late_requests_employee")
  @@index([status], map: "idx_late_requests_status")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model leave_balances {
  id                       String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employee_id              String    @db.Uuid
  year                     Int
  annual_leave_quota       Int?      @default(10)
  sick_leave_quota         Int?      @default(30)
  personal_leave_quota     Int?      @default(3)
  annual_leave_used        Decimal?  @default(0) @db.Decimal(5, 2)
  sick_leave_used          Decimal?  @default(0) @db.Decimal(5, 2)
  personal_leave_used      Decimal?  @default(0) @db.Decimal(5, 2)
  annual_leave_remaining   Decimal?  @default(10) @db.Decimal(5, 2)
  sick_leave_remaining     Decimal?  @default(30) @db.Decimal(5, 2)
  personal_leave_remaining Decimal?  @default(3) @db.Decimal(5, 2)
  created_at               DateTime? @default(now()) @db.Timestamptz(6)
  updated_at               DateTime? @default(now()) @db.Timestamptz(6)
  employees                employees @relation(fields: [employee_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([employee_id, year])
  @@index([employee_id], map: "idx_leave_balances_employee")
  @@index([year], map: "idx_leave_balances_year")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model leave_requests {
  id                                               String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employee_id                                      String     @db.Uuid
  leave_type                                       String     @db.VarChar(50)
  start_date                                       DateTime   @db.Date
  end_date                                         DateTime   @db.Date
  is_half_day                                      Boolean?   @default(false)
  reason                                           String?
  attachment_url                                   String?
  status                                           String?    @default("pending") @db.VarChar(20)
  approved_by                                      String?    @db.Uuid
  created_at                                       DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at                                       DateTime?  @default(now()) @db.Timestamptz(6)
  approved_at                                      DateTime?  @db.Timestamptz(6)
  cancelled_by                                     String?    @db.Uuid
  cancelled_at                                     DateTime?  @db.Timestamptz(6)
  cancel_reason                                    String?
  employees_leave_requests_approved_byToemployees  employees? @relation("leave_requests_approved_byToemployees", fields: [approved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees_leave_requests_cancelled_byToemployees employees? @relation("leave_requests_cancelled_byToemployees", fields: [cancelled_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees_leave_requests_employee_idToemployees  employees  @relation("leave_requests_employee_idToemployees", fields: [employee_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([employee_id], map: "idx_leave_requests_employee")
  @@index([status], map: "idx_leave_requests_status")
  @@index([approved_by], map: "idx_leave_requests_approved_by")
  @@index([cancelled_by], map: "idx_leave_requests_cancelled_by")
  @@index([start_date, end_date], map: "idx_leave_requests_dates")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model ot_requests {
  id                                            String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employee_id                                   String     @db.Uuid
  ot_type                                       String?    @default("normal") @db.VarChar(20)
  request_date                                  DateTime   @db.Date
  requested_start_time                          DateTime   @db.Timestamptz(6)
  requested_end_time                            DateTime   @db.Timestamptz(6)
  approved_start_time                           DateTime?  @db.Timestamptz(6)
  approved_end_time                             DateTime?  @db.Timestamptz(6)
  actual_start_time                             DateTime?  @db.Timestamptz(6)
  actual_end_time                               DateTime?  @db.Timestamptz(6)
  reason                                        String
  status                                        String?    @default("pending") @db.VarChar(20)
  before_photo_url                              String?
  after_photo_url                               String?
  approved_by                                   String?    @db.Uuid
  actual_ot_hours                               Decimal?   @db.Decimal(5, 2)
  approved_ot_hours                             Decimal?   @db.Decimal(5, 2)
  ot_rate                                       Decimal?   @db.Decimal(5, 2)
  ot_amount                                     Decimal?   @db.Decimal(10, 2)
  created_at                                    DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at                                    DateTime?  @default(now()) @db.Timestamptz(6)
  start_gps_lat                                 Decimal?   @db.Decimal(10, 8)
  start_gps_lng                                 Decimal?   @db.Decimal(11, 8)
  end_gps_lat                                   Decimal?   @db.Decimal(10, 8)
  end_gps_lng                                   Decimal?   @db.Decimal(11, 8)
  approved_at                                   DateTime?  @db.Timestamptz(6)
  cancelled_by                                  String?    @db.Uuid
  cancelled_at                                  DateTime?  @db.Timestamptz(6)
  cancel_reason                                 String?
  employees_ot_requests_approved_byToemployees  employees? @relation("ot_requests_approved_byToemployees", fields: [approved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees_ot_requests_cancelled_byToemployees employees? @relation("ot_requests_cancelled_byToemployees", fields: [cancelled_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees_ot_requests_employee_idToemployees  employees  @relation("ot_requests_employee_idToemployees", fields: [employee_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([cancelled_by], map: "idx_ot_requests_cancelled_by")
  @@index([employee_id], map: "idx_ot_requests_employee")
  @@index([status], map: "idx_ot_requests_status")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model push_subscriptions {
  id           String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employee_id  String    @unique @db.Uuid
  subscription Json
  user_agent   String?
  created_at   DateTime? @default(now()) @db.Timestamptz(6)
  updated_at   DateTime? @default(now()) @db.Timestamptz(6)
  employees    employees @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([employee_id], map: "idx_push_subscriptions_employee_id")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model system_settings {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  setting_key   String    @unique @db.VarChar(100)
  setting_value String?
  description   String?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @default(now()) @db.Timestamptz(6)

  @@index([setting_key], map: "idx_system_settings_key")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model wfh_requests {
  id                                             String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employee_id                                    String     @db.Uuid
  date                                           DateTime   @db.Date
  is_half_day                                    Boolean?   @default(false)
  reason                                         String
  status                                         String?    @default("pending") @db.VarChar(20)
  approved_by                                    String?    @db.Uuid
  created_at                                     DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at                                     DateTime?  @default(now()) @db.Timestamptz(6)
  approved_at                                    DateTime?  @db.Timestamptz(6)
  cancelled_by                                   String?    @db.Uuid
  cancelled_at                                   DateTime?  @db.Timestamptz(6)
  cancel_reason                                  String?
  employees_wfh_requests_approved_byToemployees  employees? @relation("wfh_requests_approved_byToemployees", fields: [approved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees_wfh_requests_cancelled_byToemployees employees? @relation("wfh_requests_cancelled_byToemployees", fields: [cancelled_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employees_wfh_requests_employee_idToemployees  employees  @relation("wfh_requests_employee_idToemployees", fields: [employee_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([employee_id], map: "idx_wfh_requests_employee")
  @@index([status], map: "idx_wfh_requests_status")
  @@index([approved_by], map: "idx_wfh_requests_approved_by")
  @@index([cancelled_by], map: "idx_wfh_requests_cancelled_by")
  @@index([date], map: "idx_wfh_requests_date")
}

model salary_history {
  id             String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employee_id    String    @db.Uuid
  base_salary    Decimal   @default(0) @db.Decimal(12, 2)
  commission     Decimal   @default(0) @db.Decimal(12, 2)
  effective_date DateTime  @db.Date
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  employees      employees @relation(fields: [employee_id], references: [id], onDelete: Cascade)

  @@index([employee_id, effective_date(sort: Desc)], map: "idx_salary_history_employee_date")
}

/// Gamification: Master badge definitions
model badge_definitions {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code            String            @unique @db.VarChar(50)
  name            String            @db.VarChar(100)
  description     String?
  icon            String            @default("üèÖ") @db.VarChar(50)
  category        String            @default("attendance") @db.VarChar(30)
  tier            String            @default("bronze") @db.VarChar(20)
  condition_type  String            @db.VarChar(50)
  condition_value Int               @default(1)
  points_reward   Int               @default(0)
  is_active       Boolean           @default(true)
  created_at      DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?         @default(now()) @db.Timestamptz(6)
  employee_badges employee_badges[]
}

/// Gamification: Earned badges per employee
model employee_badges {
  id                String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employee_id       String           @db.Uuid
  badge_id          String           @db.Uuid
  earned_at         DateTime?        @default(now()) @db.Timestamptz(6)
  month_context     String?          @db.VarChar(7)
  badge_definitions badge_definitions @relation(fields: [badge_id], references: [id], onDelete: Cascade)
  employees         employees        @relation(fields: [employee_id], references: [id], onDelete: Cascade)

  @@unique([employee_id, badge_id, month_context])
  @@index([employee_id], map: "idx_employee_badges_employee")
  @@index([badge_id], map: "idx_employee_badges_badge")
  @@index([earned_at(sort: Desc)], map: "idx_employee_badges_earned")
}

/// Gamification: Point transaction ledger
model point_transactions {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employee_id    String    @db.Uuid
  points         Int
  action_type    String    @db.VarChar(50)
  description    String?
  reference_id   String?   @db.Uuid
  reference_type String?   @db.VarChar(30)
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  employees      employees @relation(fields: [employee_id], references: [id], onDelete: Cascade)

  @@index([employee_id], map: "idx_point_transactions_employee")
  @@index([created_at(sort: Desc)], map: "idx_point_transactions_created")
  @@index([action_type], map: "idx_point_transactions_action")
}

/// Gamification: Aggregated point summary per employee
model employee_points {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employee_id      String    @unique @db.Uuid
  total_points     Int       @default(0)
  monthly_points   Int       @default(0)
  current_month    String    @default(dbgenerated("to_char(now(), 'YYYY-MM'::text)")) @db.VarChar(7)
  level            Int       @default(1)
  level_name       String    @default("Rookie") @db.VarChar(50)
  current_streak   Int       @default(0)
  longest_streak   Int       @default(0)
  last_streak_date DateTime? @db.Date
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
  employees        employees @relation(fields: [employee_id], references: [id], onDelete: Cascade)

  @@index([total_points(sort: Desc)], map: "idx_employee_points_total")
  @@index([monthly_points(sort: Desc)], map: "idx_employee_points_monthly")
  @@index([level(sort: Desc)], map: "idx_employee_points_level")
}

/// KPI: Evaluation periods
model kpi_periods {
  id                   String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String                @db.VarChar(100)
  description          String?
  start_date           DateTime              @db.Date
  end_date             DateTime              @db.Date
  goal_deadline        DateTime?             @db.Date
  self_eval_start      DateTime?             @db.Date
  self_eval_end        DateTime?             @db.Date
  supervisor_eval_end  DateTime?             @db.Date
  status               String                @default("draft") @db.VarChar(20)
  created_by           String?               @db.Uuid
  created_at           DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?             @default(now()) @db.Timestamptz(6)
  employees            employees?            @relation("kpi_periods_created_byToemployees", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  kpi_period_templates kpi_period_templates[]
  kpi_goals            kpi_goals[]
  kpi_evaluations      kpi_evaluations[]
  kpi_auto_metrics     kpi_auto_metrics[]

  @@index([status], map: "idx_kpi_periods_status")
  @@index([start_date, end_date], map: "idx_kpi_periods_dates")
}

/// KPI: Template criteria definitions
model kpi_templates {
  id                   String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String                @db.VarChar(200)
  description          String?
  category             String                @db.VarChar(30)
  evaluation_type      String                @db.VarChar(20)
  default_weight       Decimal?              @default(0) @db.Decimal(5, 2)
  score_min            Int                   @default(1)
  score_max            Int                   @default(5)
  is_active            Boolean               @default(true)
  sort_order           Int                   @default(0)
  created_at           DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?             @default(now()) @db.Timestamptz(6)
  kpi_period_templates kpi_period_templates[]
  kpi_evaluation_items kpi_evaluation_items[]

  @@index([category], map: "idx_kpi_templates_category")
  @@index([is_active], map: "idx_kpi_templates_active")
}

/// KPI: Templates assigned to a period with weights
model kpi_period_templates {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  period_id     String        @db.Uuid
  template_id   String        @db.Uuid
  weight        Decimal       @default(0) @db.Decimal(5, 2)
  is_active     Boolean       @default(true)
  kpi_periods   kpi_periods   @relation(fields: [period_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  kpi_templates kpi_templates @relation(fields: [template_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([period_id, template_id])
  @@index([period_id], map: "idx_kpi_period_templates_period")
}

/// KPI: Individual employee goals
model kpi_goals {
  id                                            String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employee_id                                   String              @db.Uuid
  period_id                                     String              @db.Uuid
  title                                         String              @db.VarChar(300)
  description                                   String?
  target_value                                  String?             @db.VarChar(100)
  target_unit                                   String?             @db.VarChar(50)
  weight                                        Decimal             @default(0) @db.Decimal(5, 2)
  status                                        String              @default("pending_approval") @db.VarChar(20)
  approved_by                                   String?             @db.Uuid
  approved_at                                   DateTime?           @db.Timestamptz(6)
  rejection_reason                              String?
  created_at                                    DateTime?           @default(now()) @db.Timestamptz(6)
  updated_at                                    DateTime?           @default(now()) @db.Timestamptz(6)
  employees_kpi_goals_employee_idToemployees    employees           @relation("kpi_goals_employee_idToemployees", fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  employees_kpi_goals_approved_byToemployees    employees?          @relation("kpi_goals_approved_byToemployees", fields: [approved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  kpi_periods                                   kpi_periods         @relation(fields: [period_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  kpi_goal_progress                             kpi_goal_progress[]
  kpi_evaluation_items                          kpi_evaluation_items[]

  @@index([employee_id], map: "idx_kpi_goals_employee")
  @@index([period_id], map: "idx_kpi_goals_period")
  @@index([status], map: "idx_kpi_goals_status")
}

/// KPI: Goal progress updates
model kpi_goal_progress {
  id                                                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  goal_id                                           String    @db.Uuid
  progress_value                                    String?   @db.VarChar(100)
  progress_percent                                  Decimal?  @default(0) @db.Decimal(5, 2)
  note                                              String?
  attachment_url                                    String?
  created_by                                        String?   @db.Uuid
  created_at                                        DateTime? @default(now()) @db.Timestamptz(6)
  kpi_goals                                         kpi_goals @relation(fields: [goal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  employees_kpi_goal_progress_created_byToemployees employees? @relation("kpi_goal_progress_created_byToemployees", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([goal_id], map: "idx_kpi_goal_progress_goal")
  @@index([created_at(sort: Desc)], map: "idx_kpi_goal_progress_created")
}

/// KPI: Evaluation records (self or supervisor)
model kpi_evaluations {
  id                                                    String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employee_id                                           String                @db.Uuid
  period_id                                             String                @db.Uuid
  evaluator_id                                          String                @db.Uuid
  evaluation_type                                       String                @db.VarChar(20)
  status                                                String                @default("draft") @db.VarChar(20)
  overall_score                                         Decimal?              @db.Decimal(5, 2)
  overall_grade                                         String?               @db.VarChar(10)
  overall_comment                                       String?
  submitted_at                                          DateTime?             @db.Timestamptz(6)
  created_at                                            DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at                                            DateTime?             @default(now()) @db.Timestamptz(6)
  employees_kpi_evaluations_employee_idToemployees      employees             @relation("kpi_evaluations_employee_idToemployees", fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  employees_kpi_evaluations_evaluator_idToemployees     employees             @relation("kpi_evaluations_evaluator_idToemployees", fields: [evaluator_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  kpi_periods                                           kpi_periods           @relation(fields: [period_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  kpi_evaluation_items                                  kpi_evaluation_items[]

  @@unique([employee_id, period_id, evaluation_type])
  @@index([employee_id], map: "idx_kpi_evaluations_employee")
  @@index([period_id], map: "idx_kpi_evaluations_period")
  @@index([evaluator_id], map: "idx_kpi_evaluations_evaluator")
  @@index([status], map: "idx_kpi_evaluations_status")
}

/// KPI: Individual evaluation item scores
model kpi_evaluation_items {
  id              String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  evaluation_id   String           @db.Uuid
  template_id     String?          @db.Uuid
  goal_id         String?          @db.Uuid
  category        String           @db.VarChar(30)
  score           Decimal?         @db.Decimal(5, 2)
  weight          Decimal          @default(0) @db.Decimal(5, 2)
  comment         String?
  kpi_evaluations kpi_evaluations  @relation(fields: [evaluation_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  kpi_templates   kpi_templates?   @relation(fields: [template_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  kpi_goals       kpi_goals?       @relation(fields: [goal_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([evaluation_id], map: "idx_kpi_eval_items_evaluation")
  @@index([template_id], map: "idx_kpi_eval_items_template")
}

/// KPI: Auto-calculated metrics snapshot per period
model kpi_auto_metrics {
  id                 String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employee_id        String      @db.Uuid
  period_id          String      @db.Uuid
  total_working_days Int         @default(0)
  days_present       Int         @default(0)
  days_late          Int         @default(0)
  days_absent        Int         @default(0)
  attendance_rate    Decimal?    @db.Decimal(5, 2)
  punctuality_rate   Decimal?    @db.Decimal(5, 2)
  total_leave_days   Decimal?    @default(0) @db.Decimal(5, 2)
  total_ot_hours     Decimal?    @default(0) @db.Decimal(5, 2)
  calculated_score   Decimal?    @db.Decimal(5, 2)
  calculated_at      DateTime?   @db.Timestamptz(6)
  created_at         DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?   @default(now()) @db.Timestamptz(6)
  employees          employees   @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  kpi_periods        kpi_periods @relation(fields: [period_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([employee_id, period_id])
  @@index([employee_id], map: "idx_kpi_auto_metrics_employee")
  @@index([period_id], map: "idx_kpi_auto_metrics_period")
}
